<?xml version="1.0" encoding="utf-8"?>
<s:BorderContainer xmlns:fx="http://ns.adobe.com/mxml/2009" 
		  xmlns:s="library://ns.adobe.com/flex/spark" 
		  xmlns:mx="library://ns.adobe.com/flex/mx" >
	
	<s:layout>
		<s:VerticalLayout gap="0"/>
	</s:layout>
	<fx:Script>
		<![CDATA[
			
			import mx.graphics.codec.JPEGEncoder;
			import mx.managers.PopUpManager;
			import mx.utils.Base64Decoder;
			import mx.utils.Base64Encoder;
			
			

			
			protected var picB64Data:String;
			
			public function set dataInBase64(data:String):void{
				
				this.picB64Data = data;
				if(data != null){
					var d:Base64Decoder = new Base64Decoder();
					d.decode(data);
					var ba:ByteArray = d.toByteArray();
					ba.uncompress();
					img.source = ba;
				}
				else
					img.source = null;
				
			}
			public function getdataInBase64():String{
				if(img.content != null){
					var jpegEncoder:JPEGEncoder=new JPEGEncoder(50);
					var bd:BitmapData = new BitmapData(330,330);
					var m:Matrix = new Matrix(330.0/img.content.width,0,0,330.0/img.content.height,0,0);
					bd.draw(img.content,m);
					var jpegData:ByteArray = jpegEncoder.encode(bd);
					jpegData.compress();
					var base64Encoder:Base64Encoder = new Base64Encoder();
					base64Encoder.encodeBytes(jpegData);
					this.picB64Data = base64Encoder.toString();
					
				}
				return this.picB64Data;
			}
			var fileReference:FileReference
			protected function upload(evt:MouseEvent):void {
				fileReference = new FileReference();
				fileReference.addEventListener(Event.SELECT,function(evt:Event):void{					
					fileReference.load();
				});
				fileReference.addEventListener(Event.COMPLETE,function fileReference_complete(evt:Event):void{
					
					img.source = fileReference.data;
				});
				var arr:Array = [];
				arr.push(new FileFilter("Images", ".gif;*.jpeg;*.jpg;*.png"));
				fileReference.browse(arr);
			}
			
			protected function beginSnapShot():void{
				var w:PhotoShotComponent = new PhotoShotComponent();
				w.pic = this;
				PopUpManager.addPopUp(w,parent,true);
				PopUpManager.centerPopUp(w);
			}

		]]>
	</fx:Script>
	<mx:Image id="img" smoothBitmapContent="true"  x="0" y="0" width="120" height="120" />
	<s:Group width="120" height="20">
		<s:Button id="uploadButton" label="上传" width="39" height="20" fontSize="9" left="7" click="upload(event)" />
		<s:Button id="beginShot" label="开始拍照" width="59" height="20" fontSize="9" right="7" click="beginSnapShot()"/>
	</s:Group>
	
</s:BorderContainer>
